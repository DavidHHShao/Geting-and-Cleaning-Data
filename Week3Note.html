<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title></title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>



<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>#Subsetting and sorting 
##Subsetting-Quick Review</p>

<pre><code class="r">set.seed(13435)
X&lt;-data.frame(&quot;var1&quot;=sample(1:5), &quot;var2&quot;=sample(6:10),&quot;var3&quot;=sample(11:15))
X&lt;-X[sample(1:5),]
X$var2[c(1,3)]=NA
X
</code></pre>

<pre><code>##   var1 var2 var3
## 1    2   NA   15
## 4    1   10   11
## 2    3   NA   12
## 3    5    6   14
## 5    4    9   13
</code></pre>

<pre><code class="r">X[,1]
</code></pre>

<pre><code>## [1] 2 1 3 5 4
</code></pre>

<pre><code class="r">X[,&quot;var1&quot;]
</code></pre>

<pre><code>## [1] 2 1 3 5 4
</code></pre>

<pre><code class="r">X[1:2,&quot;var2&quot;]
</code></pre>

<pre><code>## [1] NA 10
</code></pre>

<pre><code class="r">X[(X$var1&lt;=3 &amp; X$var3&gt;11),]
</code></pre>

<pre><code>##   var1 var2 var3
## 1    2   NA   15
## 2    3   NA   12
</code></pre>

<pre><code class="r">X[(X$var1&lt;=3 | X$var3&gt;11),]
</code></pre>

<pre><code>##   var1 var2 var3
## 1    2   NA   15
## 4    1   10   11
## 2    3   NA   12
## 3    5    6   14
## 5    4    9   13
</code></pre>

<p>&ldquo;which&rdquo; does not return indices of NAs</p>

<pre><code class="r">X[which(X$var2&gt;8),]
</code></pre>

<pre><code>##   var1 var2 var3
## 4    1   10   11
## 5    4    9   13
</code></pre>

<p>##Sorting</p>

<pre><code class="r">sort(X$var1)
</code></pre>

<pre><code>## [1] 1 2 3 4 5
</code></pre>

<pre><code class="r">sort(X$var1, decreasing=TRUE)
</code></pre>

<pre><code>## [1] 5 4 3 2 1
</code></pre>

<p>&ldquo;na.last&rdquo; put NAs at the last of sorting</p>

<pre><code class="r">sort(X$var2,na.last=TRUE)
</code></pre>

<pre><code>## [1]  6  9 10 NA NA
</code></pre>

<p>order the dataframe by a particular variable</p>

<pre><code class="r">X[order(X$var1),]
</code></pre>

<pre><code>##   var1 var2 var3
## 4    1   10   11
## 1    2   NA   15
## 2    3   NA   12
## 5    4    9   13
## 3    5    6   14
</code></pre>

<p>order the dataframe by two particular variable, var1 first then var3</p>

<pre><code class="r">X[order(X$var1,X$var3),]
</code></pre>

<pre><code>##   var1 var2 var3
## 4    1   10   11
## 1    2   NA   15
## 2    3   NA   12
## 5    4    9   13
## 3    5    6   14
</code></pre>

<p>using &ldquo;plyr&rdquo; package to sort</p>

<pre><code class="r">library(plyr)
arrange(X,var1)
</code></pre>

<pre><code>##   var1 var2 var3
## 1    1   10   11
## 2    2   NA   15
## 3    3   NA   12
## 4    4    9   13
## 5    5    6   14
</code></pre>

<pre><code class="r">arrange(X,desc(var1))
</code></pre>

<pre><code>##   var1 var2 var3
## 1    5    6   14
## 2    4    9   13
## 3    3   NA   12
## 4    2   NA   15
## 5    1   10   11
</code></pre>

<p>##Adding rows and columns
adding columns</p>

<pre><code class="r">X$var4&lt;-rnorm(5)
X
</code></pre>

<pre><code>##   var1 var2 var3       var4
## 1    2   NA   15  0.1875960
## 4    1   10   11  1.7869764
## 2    3   NA   12  0.4966936
## 3    5    6   14  0.0631830
## 5    4    9   13 -0.5361329
</code></pre>

<p>using&quot;cbind&quot; to add columns</p>

<pre><code class="r">Y&lt;-cbind(X,rnorm(5))
Y
</code></pre>

<pre><code>##   var1 var2 var3       var4    rnorm(5)
## 1    2   NA   15  0.1875960  0.62578490
## 4    1   10   11  1.7869764 -2.45083750
## 2    3   NA   12  0.4966936  0.08909424
## 3    5    6   14  0.0631830  0.47838570
## 5    4    9   13 -0.5361329  1.00053336
</code></pre>

<pre><code class="r">Z&lt;-rnorm(5)
Y&lt;-cbind(Z,X)
Y
</code></pre>

<pre><code>##            Z var1 var2 var3       var4
## 1  0.5439561    2   NA   15  0.1875960
## 4  0.3304796    1   10   11  1.7869764
## 2 -0.9710917    3   NA   12  0.4966936
## 3 -0.9446847    5    6   14  0.0631830
## 5 -0.2967423    4    9   13 -0.5361329
</code></pre>

<p>using&quot;rbind&quot; to add rows</p>

<pre><code class="r">Y&lt;-rbind(X,rnorm(5))
Y
</code></pre>

<pre><code>##       var1       var2       var3       var4
## 1 2.000000         NA 15.0000000  0.1875960
## 4 1.000000 10.0000000 11.0000000  1.7869764
## 2 3.000000         NA 12.0000000  0.4966936
## 3 5.000000  6.0000000 14.0000000  0.0631830
## 5 4.000000  9.0000000 13.0000000 -0.5361329
## 6 1.149505 -0.8705105 -0.9870139  0.3262530
</code></pre>

<pre><code class="r">Z&lt;-rnorm(5)
Y&lt;-rbind(Z,X)
Y
</code></pre>

<pre><code>##         var1       var2       var3       var4
## 1  -1.010516  0.6095613  0.5041528  1.3798872
## 11  2.000000         NA 15.0000000  0.1875960
## 4   1.000000 10.0000000 11.0000000  1.7869764
## 2   3.000000         NA 12.0000000  0.4966936
## 3   5.000000  6.0000000 14.0000000  0.0631830
## 5   4.000000  9.0000000 13.0000000 -0.5361329
</code></pre>

<p>#Summarizing data
<a href="https://data.baltimorecity.gov/Community/Restaurants/k5ry-ef3g">Data Source</a></p>

<p>##Getting the data from the web</p>

<pre><code class="r">#if(!file.exists(&quot;./data&quot;)){dir.create(&quot;./data&quot;)}
#fileUrl &lt;- &quot;https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accessType=DOWNLOAD&quot;
#download.file(fileUrl,destfile=&quot;./data/restaurants.csv&quot;,method=&quot;curl&quot;)
restData &lt;- read.csv(&quot;./data/restaurants.csv&quot;)
</code></pre>

<p>##Look at a bit of the data
default is n=6</p>

<pre><code class="r">head(restData,n=3)
</code></pre>

<pre><code>##    name zipCode neighborhood councilDistrict policeDistrict
## 1   410   21206    Frankford               2   NORTHEASTERN
## 2  1919   21231  Fells Point               1   SOUTHEASTERN
## 3 SAUTE   21224       Canton               1   SOUTHEASTERN
##                          Location.1
## 1 4509 BELAIR ROAD\nBaltimore, MD\n
## 2    1919 FLEET ST\nBaltimore, MD\n
## 3   2844 HUDSON ST\nBaltimore, MD\n
</code></pre>

<pre><code class="r">tail(restData,n=3)
</code></pre>

<pre><code>##                  name zipCode  neighborhood councilDistrict policeDistrict
## 1325 ZINK&#39;S CAF\u0090   21213 Belair-Edison              13   NORTHEASTERN
## 1326     ZISSIMOS BAR   21211       Hampden               7       NORTHERN
## 1327           ZORBAS   21224     Greektown               2   SOUTHEASTERN
##                              Location.1
## 1325 3300 LAWNVIEW AVE\nBaltimore, MD\n
## 1326      1023 36TH ST\nBaltimore, MD\n
## 1327  4710 EASTERN Ave\nBaltimore, MD\n
</code></pre>

<p>##Make summary</p>

<pre><code class="r">summary(restData)
</code></pre>

<pre><code>##                            name         zipCode             neighborhood
##  MCDONALD&#39;S                  :   8   Min.   :-21226   Downtown    :128  
##  POPEYES FAMOUS FRIED CHICKEN:   7   1st Qu.: 21202   Fells Point : 91  
##  SUBWAY                      :   6   Median : 21218   Inner Harbor: 89  
##  KENTUCKY FRIED CHICKEN      :   5   Mean   : 21185   Canton      : 81  
##  BURGER KING                 :   4   3rd Qu.: 21226   Federal Hill: 42  
##  DUNKIN DONUTS               :   4   Max.   : 21287   Mount Vernon: 33  
##  (Other)                     :1293                    (Other)     :863  
##  councilDistrict       policeDistrict
##  Min.   : 1.000   SOUTHEASTERN:385   
##  1st Qu.: 2.000   CENTRAL     :288   
##  Median : 9.000   SOUTHERN    :213   
##  Mean   : 7.191   NORTHERN    :157   
##  3rd Qu.:11.000   NORTHEASTERN: 72   
##  Max.   :14.000   EASTERN     : 67   
##                   (Other)     :145   
##                         Location.1      
##  1101 RUSSELL ST\nBaltimore, MD\n:   9  
##  201 PRATT ST\nBaltimore, MD\n   :   8  
##  2400 BOSTON ST\nBaltimore, MD\n :   8  
##  300 LIGHT ST\nBaltimore, MD\n   :   5  
##  300 CHARLES ST\nBaltimore, MD\n :   4  
##  301 LIGHT ST\nBaltimore, MD\n   :   4  
##  (Other)                         :1289
</code></pre>

<p>##More in depth information</p>

<pre><code class="r">str(restData)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    1327 obs. of  6 variables:
##  $ name           : Factor w/ 1277 levels &quot;#1 CHINESE KITCHEN&quot;,..: 9 3 992 1 2 4 5 6 7 8 ...
##  $ zipCode        : int  21206 21231 21224 21211 21223 21218 21205 21211 21205 21231 ...
##  $ neighborhood   : Factor w/ 173 levels &quot;Abell&quot;,&quot;Arlington&quot;,..: 53 52 18 66 104 33 98 133 98 157 ...
##  $ councilDistrict: int  2 1 1 14 9 14 13 7 13 1 ...
##  $ policeDistrict : Factor w/ 9 levels &quot;CENTRAL&quot;,&quot;EASTERN&quot;,..: 3 6 6 4 8 3 6 4 6 6 ...
##  $ Location.1     : Factor w/ 1210 levels &quot;1 BIDDLE ST\nBaltimore, MD\n&quot;,..: 835 334 554 755 492 537 505 530 507 569 ...
</code></pre>

<p>##Quantiles of quantitative variables</p>

<pre><code class="r">quantile(restData$councilDistrict,na.rm=TRUE)
</code></pre>

<pre><code>##   0%  25%  50%  75% 100% 
##    1    2    9   11   14
</code></pre>

<pre><code class="r">quantile(restData$councilDistrict,probs=c(0.5,0.75,0.9))
</code></pre>

<pre><code>## 50% 75% 90% 
##   9  11  12
</code></pre>

<p>##Make table
useNA=&ldquo;ifany&rdquo; will tell the number of missing value
Default of &ldquo;table&rdquo;&ldquo; will not tell the number of missing value</p>

<pre><code class="r">table(restData$zipCode,useNA=&quot;ifany&quot;)
</code></pre>

<pre><code>## 
## -21226  21201  21202  21205  21206  21207  21208  21209  21210  21211 
##      1    136    201     27     30      4      1      8     23     41 
##  21212  21213  21214  21215  21216  21217  21218  21220  21222  21223 
##     28     31     17     54     10     32     69      1      7     56 
##  21224  21225  21226  21227  21229  21230  21231  21234  21237  21239 
##    199     19     18      4     13    156    127      7      1      3 
##  21251  21287 
##      2      1
</code></pre>

<p>Two dimensional Table ( can be 3D )</p>

<pre><code class="r">table(restData$councilDistrict,restData$zipCode)
</code></pre>

<pre><code>##     
##      -21226 21201 21202 21205 21206 21207 21208 21209 21210 21211 21212
##   1       0     0    37     0     0     0     0     0     0     0     0
##   2       0     0     0     3    27     0     0     0     0     0     0
##   3       0     0     0     0     0     0     0     0     0     0     0
##   4       0     0     0     0     0     0     0     0     0     0    27
##   5       0     0     0     0     0     3     0     6     0     0     0
##   6       0     0     0     0     0     0     0     1    19     0     0
##   7       0     0     0     0     0     0     0     1     0    27     0
##   8       0     0     0     0     0     1     0     0     0     0     0
##   9       0     1     0     0     0     0     0     0     0     0     0
##   10      1     0     1     0     0     0     0     0     0     0     0
##   11      0   115   139     0     0     0     1     0     0     0     1
##   12      0    20    24     4     0     0     0     0     0     0     0
##   13      0     0     0    20     3     0     0     0     0     0     0
##   14      0     0     0     0     0     0     0     0     4    14     0
##     
##      21213 21214 21215 21216 21217 21218 21220 21222 21223 21224 21225
##   1      2     0     0     0     0     0     0     7     0   140     1
##   2      0     0     0     0     0     0     0     0     0    54     0
##   3      2    17     0     0     0     3     0     0     0     0     0
##   4      0     0     0     0     0     0     0     0     0     0     0
##   5      0     0    31     0     0     0     0     0     0     0     0
##   6      0     0    15     1     0     0     0     0     0     0     0
##   7      0     0     6     7    15     6     0     0     0     0     0
##   8      0     0     0     0     0     0     0     0     2     0     0
##   9      0     0     0     2     8     0     0     0    53     0     0
##   10     0     0     0     0     0     0     1     0     0     0    18
##   11     0     0     0     0     9     0     0     0     1     0     0
##   12    13     0     0     0     0    26     0     0     0     0     0
##   13    13     0     1     0     0     0     0     0     0     5     0
##   14     1     0     1     0     0    34     0     0     0     0     0
##     
##      21226 21227 21229 21230 21231 21234 21237 21239 21251 21287
##   1      0     0     0     1   124     0     0     0     0     0
##   2      0     0     0     0     0     0     1     0     0     0
##   3      0     1     0     0     0     7     0     0     2     0
##   4      0     0     0     0     0     0     0     3     0     0
##   5      0     0     0     0     0     0     0     0     0     0
##   6      0     0     0     0     0     0     0     0     0     0
##   7      0     0     0     0     0     0     0     0     0     0
##   8      0     2    13     0     0     0     0     0     0     0
##   9      0     0     0    11     0     0     0     0     0     0
##   10    18     0     0   133     0     0     0     0     0     0
##   11     0     0     0    11     0     0     0     0     0     0
##   12     0     0     0     0     2     0     0     0     0     0
##   13     0     1     0     0     1     0     0     0     0     1
##   14     0     0     0     0     0     0     0     0     0     0
</code></pre>

<p>##Check for missing values</p>

<pre><code class="r">sum(is.na(restData$councilDistrict))
</code></pre>

<pre><code>## [1] 0
</code></pre>

<pre><code class="r">any(is.na(restData$councilDistrict))
</code></pre>

<pre><code>## [1] FALSE
</code></pre>

<pre><code class="r">all(restData$zipCode &gt; 0)
</code></pre>

<pre><code>## [1] FALSE
</code></pre>

<p>##Row and column sums</p>

<pre><code class="r">colSums(is.na(restData))
</code></pre>

<pre><code>##            name         zipCode    neighborhood councilDistrict 
##               0               0               0               0 
##  policeDistrict      Location.1 
##               0               0
</code></pre>

<pre><code class="r">colSums(X)
</code></pre>

<pre><code>##      var1      var2      var3      var4 
## 15.000000        NA 65.000000  1.998316
</code></pre>

<pre><code class="r">rowSums(is.na(restData))
</code></pre>

<pre><code>##    [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##   [35] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##   [69] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [103] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [137] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [171] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [205] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [239] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [273] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [307] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [341] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [375] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [409] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [443] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [477] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [511] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [545] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [579] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [613] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [647] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [681] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [715] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [749] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [783] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [817] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [851] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [885] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [919] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [953] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [987] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1021] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1055] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1089] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1123] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1157] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1191] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1225] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1259] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1293] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [1327] 0
</code></pre>

<pre><code class="r">rowSums(X)
</code></pre>

<pre><code>##        1        4        2        3        5 
##       NA 23.78698       NA 25.06318 25.46387
</code></pre>

<pre><code class="r">all(colSums(is.na(restData))==0)
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<p>##Values with specific characteristics</p>

<pre><code class="r">table(restData$zipCode %in% c(&quot;21212&quot;))
</code></pre>

<pre><code>## 
## FALSE  TRUE 
##  1299    28
</code></pre>

<pre><code class="r">table(restData$zipCode %in% c(&quot;21212&quot;,&quot;21213&quot;))
</code></pre>

<pre><code>## 
## FALSE  TRUE 
##  1268    59
</code></pre>

<pre><code class="r">filter&lt;-restData[restData$zipCode %in% c(&quot;21212&quot;,&quot;21213&quot;),]
head(filter)
</code></pre>

<pre><code>##                           name zipCode              neighborhood
## 29           BAY ATLANTIC CLUB   21212                  Downtown
## 39                 BERMUDA BAR   21213             Broadway East
## 92                   ATWATER&#39;S   21212 Chinquapin Park-Belvedere
## 111 BALTIMORE ESTONIAN SOCIETY   21213        South Clifton Park
## 187                   CAFE ZEN   21212                  Rosebank
## 220        CERIELLO FINE FOODS   21212 Chinquapin Park-Belvedere
##     councilDistrict policeDistrict                         Location.1
## 29               11        CENTRAL    206 REDWOOD ST\nBaltimore, MD\n
## 39               12        EASTERN    1801 NORTH AVE\nBaltimore, MD\n
## 92                4       NORTHERN 529 BELVEDERE AVE\nBaltimore, MD\n
## 111              12        EASTERN    1932 BELAIR RD\nBaltimore, MD\n
## 187               4       NORTHERN 438 BELVEDERE AVE\nBaltimore, MD\n
## 220               4       NORTHERN 529 BELVEDERE AVE\nBaltimore, MD\n
</code></pre>

<p>##Cross tabs</p>

<pre><code class="r">data(UCBAdmissions)
DF = as.data.frame(UCBAdmissions)
</code></pre>

<pre><code class="r">summary(DF)
</code></pre>

<pre><code>##       Admit       Gender   Dept       Freq      
##  Admitted:12   Male  :12   A:4   Min.   :  8.0  
##  Rejected:12   Female:12   B:4   1st Qu.: 80.0  
##                            C:4   Median :170.0  
##                            D:4   Mean   :188.6  
##                            E:4   3rd Qu.:302.5  
##                            F:4   Max.   :512.0
</code></pre>

<pre><code class="r">str(DF)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    24 obs. of  4 variables:
##  $ Admit : Factor w/ 2 levels &quot;Admitted&quot;,&quot;Rejected&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ Gender: Factor w/ 2 levels &quot;Male&quot;,&quot;Female&quot;: 1 1 2 2 1 1 2 2 1 1 ...
##  $ Dept  : Factor w/ 6 levels &quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,..: 1 1 1 1 2 2 2 2 3 3 ...
##  $ Freq  : num  512 313 89 19 353 207 17 8 120 205 ...
</code></pre>

<pre><code class="r">head(DF)
</code></pre>

<pre><code>##      Admit Gender Dept Freq
## 1 Admitted   Male    A  512
## 2 Rejected   Male    A  313
## 3 Admitted Female    A   89
## 4 Rejected Female    A   19
## 5 Admitted   Male    B  353
## 6 Rejected   Male    B  207
</code></pre>

<p>two facors: Gender and Admit</p>

<pre><code class="r">xt &lt;- xtabs(Freq ~ Gender + Admit,data=DF)
xt
</code></pre>

<pre><code>##         Admit
## Gender   Admitted Rejected
##   Male       1198     1493
##   Female      557     1278
</code></pre>

<p>##Flat tables</p>

<pre><code class="r">str(warpbreaks)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    54 obs. of  3 variables:
##  $ breaks : num  26 30 54 25 70 52 51 26 67 18 ...
##  $ wool   : Factor w/ 2 levels &quot;A&quot;,&quot;B&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ tension: Factor w/ 3 levels &quot;L&quot;,&quot;M&quot;,&quot;H&quot;: 1 1 1 1 1 1 1 1 1 2 ...
</code></pre>

<pre><code class="r">head(warpbreaks)
</code></pre>

<pre><code>##   breaks wool tension
## 1     26    A       L
## 2     30    A       L
## 3     54    A       L
## 4     25    A       L
## 5     70    A       L
## 6     52    A       L
</code></pre>

<pre><code class="r">warpbreaks$replicate &lt;- rep(1:9, len = 54)
str(warpbreaks)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    54 obs. of  4 variables:
##  $ breaks   : num  26 30 54 25 70 52 51 26 67 18 ...
##  $ wool     : Factor w/ 2 levels &quot;A&quot;,&quot;B&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ tension  : Factor w/ 3 levels &quot;L&quot;,&quot;M&quot;,&quot;H&quot;: 1 1 1 1 1 1 1 1 1 2 ...
##  $ replicate: int  1 2 3 4 5 6 7 8 9 1 ...
</code></pre>

<pre><code class="r">warpbreaks
</code></pre>

<pre><code>##    breaks wool tension replicate
## 1      26    A       L         1
## 2      30    A       L         2
## 3      54    A       L         3
## 4      25    A       L         4
## 5      70    A       L         5
## 6      52    A       L         6
## 7      51    A       L         7
## 8      26    A       L         8
## 9      67    A       L         9
## 10     18    A       M         1
## 11     21    A       M         2
## 12     29    A       M         3
## 13     17    A       M         4
## 14     12    A       M         5
## 15     18    A       M         6
## 16     35    A       M         7
## 17     30    A       M         8
## 18     36    A       M         9
## 19     36    A       H         1
## 20     21    A       H         2
## 21     24    A       H         3
## 22     18    A       H         4
## 23     10    A       H         5
## 24     43    A       H         6
## 25     28    A       H         7
## 26     15    A       H         8
## 27     26    A       H         9
## 28     27    B       L         1
## 29     14    B       L         2
## 30     29    B       L         3
## 31     19    B       L         4
## 32     29    B       L         5
## 33     31    B       L         6
## 34     41    B       L         7
## 35     20    B       L         8
## 36     44    B       L         9
## 37     42    B       M         1
## 38     26    B       M         2
## 39     19    B       M         3
## 40     16    B       M         4
## 41     39    B       M         5
## 42     28    B       M         6
## 43     21    B       M         7
## 44     39    B       M         8
## 45     29    B       M         9
## 46     20    B       H         1
## 47     21    B       H         2
## 48     24    B       H         3
## 49     17    B       H         4
## 50     13    B       H         5
## 51     15    B       H         6
## 52     15    B       H         7
## 53     16    B       H         8
## 54     28    B       H         9
</code></pre>

<pre><code class="r">warpbreaks$replicate &lt;- rep(1:9, len = 54)
xt = xtabs(breaks ~.,data=warpbreaks)
xt
</code></pre>

<pre><code>## , , replicate = 1
## 
##     tension
## wool  L  M  H
##    A 26 18 36
##    B 27 42 20
## 
## , , replicate = 2
## 
##     tension
## wool  L  M  H
##    A 30 21 21
##    B 14 26 21
## 
## , , replicate = 3
## 
##     tension
## wool  L  M  H
##    A 54 29 24
##    B 29 19 24
## 
## , , replicate = 4
## 
##     tension
## wool  L  M  H
##    A 25 17 18
##    B 19 16 17
## 
## , , replicate = 5
## 
##     tension
## wool  L  M  H
##    A 70 12 10
##    B 29 39 13
## 
## , , replicate = 6
## 
##     tension
## wool  L  M  H
##    A 52 18 43
##    B 31 28 15
## 
## , , replicate = 7
## 
##     tension
## wool  L  M  H
##    A 51 35 28
##    B 41 21 15
## 
## , , replicate = 8
## 
##     tension
## wool  L  M  H
##    A 26 30 15
##    B 20 39 16
## 
## , , replicate = 9
## 
##     tension
## wool  L  M  H
##    A 67 36 26
##    B 44 29 28
</code></pre>

<pre><code class="r">ftable(xt)
</code></pre>

<pre><code>##              replicate  1  2  3  4  5  6  7  8  9
## wool tension                                     
## A    L                 26 30 54 25 70 52 51 26 67
##      M                 18 21 29 17 12 18 35 30 36
##      H                 36 21 24 18 10 43 28 15 26
## B    L                 27 14 29 19 29 31 41 20 44
##      M                 42 26 19 16 39 28 21 39 29
##      H                 20 21 24 17 13 15 15 16 28
</code></pre>

<p>##Size of a data set</p>

<pre><code class="r">fakeData = rnorm(1e5)
object.size(fakeData)
</code></pre>

<pre><code>## 800040 bytes
</code></pre>

<pre><code class="r">print(object.size(fakeData),units=&quot;Mb&quot;)
</code></pre>

<pre><code>## 0.8 Mb
</code></pre>

<p>#Creating new variables
##Why create new variables?</p>

<ul>
<li>Often the raw data won&#39;t have a value you are looking for</li>
<li>You will need to transform the data to get the values you would like</li>
<li>Usually you will add those values to the data frames you are working with</li>
<li>Common variables to create

<ul>
<li>Missingness indicators</li>
<li>&quot;Cutting up&rdquo; quantitative variables</li>
<li> Applying transforms
##Getting the data from the web</li>
</ul></li>
</ul>

<pre><code class="r">#if(!file.exists(&quot;./data&quot;)){dir.create(&quot;./data&quot;)}
#fileUrl &lt;- &quot;https://data.baltimorecity.gov/api/views/k5ry-ef3g/rows.csv?accessType=DOWNLOAD&quot;
#download.file(fileUrl,destfile=&quot;./data/restaurants.csv&quot;,method=&quot;curl&quot;)
#restData &lt;- read.csv(&quot;./data/restaurants.csv&quot;)
</code></pre>

<p>##Creating sequences
Sometimes you need an index for your data set</p>

<pre><code class="r">s1 &lt;- seq(1,10,by=2); 
s1
</code></pre>

<pre><code>## [1] 1 3 5 7 9
</code></pre>

<pre><code class="r">s2 &lt;- seq(1,10,length=3);
s2
</code></pre>

<pre><code>## [1]  1.0  5.5 10.0
</code></pre>

<p>Create index for variavle</p>

<pre><code class="r">x &lt;- c(1,3,8,25,100); 
seq(along = x)
</code></pre>

<pre><code>## [1] 1 2 3 4 5
</code></pre>

<p>##Subsetting variables</p>

<pre><code class="r">restData$nearMe = restData$neighborhood %in% c(&quot;Roland Park&quot;, &quot;Homeland&quot;)
table(restData$nearMe)
</code></pre>

<pre><code>## 
## FALSE  TRUE 
##  1314    13
</code></pre>

<p>##Creating binary variables
ifelse helps creat binary variables</p>

<pre><code class="r">restData$zipWrong = ifelse(restData$zipCode &lt; 0, TRUE, FALSE)
table(restData$zipWrong,restData$zipCode &lt; 0)
</code></pre>

<pre><code>##        
##         FALSE TRUE
##   FALSE  1326    0
##   TRUE      0    1
</code></pre>

<p>##Creating categorical variables</p>

<pre><code class="r">restData$zipGroups = cut(restData$zipCode,breaks=quantile(restData$zipCode))
table(restData$zipGroups)
</code></pre>

<pre><code>## 
## (-2.123e+04,2.12e+04]  (2.12e+04,2.122e+04] (2.122e+04,2.123e+04] 
##                   337                   375                   282 
## (2.123e+04,2.129e+04] 
##                   332
</code></pre>

<pre><code class="r">table(restData$zipGroups,restData$zipCode)
</code></pre>

<pre><code>##                        
##                         -21226 21201 21202 21205 21206 21207 21208 21209
##   (-2.123e+04,2.12e+04]      0   136   201     0     0     0     0     0
##   (2.12e+04,2.122e+04]       0     0     0    27    30     4     1     8
##   (2.122e+04,2.123e+04]      0     0     0     0     0     0     0     0
##   (2.123e+04,2.129e+04]      0     0     0     0     0     0     0     0
##                        
##                         21210 21211 21212 21213 21214 21215 21216 21217
##   (-2.123e+04,2.12e+04]     0     0     0     0     0     0     0     0
##   (2.12e+04,2.122e+04]     23    41    28    31    17    54    10    32
##   (2.122e+04,2.123e+04]     0     0     0     0     0     0     0     0
##   (2.123e+04,2.129e+04]     0     0     0     0     0     0     0     0
##                        
##                         21218 21220 21222 21223 21224 21225 21226 21227
##   (-2.123e+04,2.12e+04]     0     0     0     0     0     0     0     0
##   (2.12e+04,2.122e+04]     69     0     0     0     0     0     0     0
##   (2.122e+04,2.123e+04]     0     1     7    56   199    19     0     0
##   (2.123e+04,2.129e+04]     0     0     0     0     0     0    18     4
##                        
##                         21229 21230 21231 21234 21237 21239 21251 21287
##   (-2.123e+04,2.12e+04]     0     0     0     0     0     0     0     0
##   (2.12e+04,2.122e+04]      0     0     0     0     0     0     0     0
##   (2.122e+04,2.123e+04]     0     0     0     0     0     0     0     0
##   (2.123e+04,2.129e+04]    13   156   127     7     1     3     2     1
</code></pre>

<p>##Easier cutting</p>

<pre><code class="r">library(Hmisc);
</code></pre>

<pre><code>## Loading required package: grid
## Loading required package: survival
## Loading required package: splines
## Loading required package: Formula
## 
## Attaching package: &#39;Hmisc&#39;
## 
## The following objects are masked from &#39;package:plyr&#39;:
## 
##     is.discrete, summarize
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     format.pval, round.POSIXt, trunc.POSIXt, units
</code></pre>

<pre><code class="r">restData$zipGroups = cut2(restData$zipCode,g=4)
table(restData$zipGroups)
</code></pre>

<pre><code>## 
## [-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
##            338            375            300            314
</code></pre>

<p>##Creating factor variables</p>

<pre><code class="r">restData$zcf &lt;- factor(restData$zipCode)
restData$zcf[1:10]
</code></pre>

<pre><code>##  [1] 21206 21231 21224 21211 21223 21218 21205 21211 21205 21231
## 32 Levels: -21226 21201 21202 21205 21206 21207 21208 21209 ... 21287
</code></pre>

<pre><code class="r">class(restData$zcf)
</code></pre>

<pre><code>## [1] &quot;factor&quot;
</code></pre>

<p>##Levels of factor variables
relevel: The levels of a factor are re-ordered so that the level specified by ref is first and the others are moved down. This is useful for contr.treatment contrasts which take the first level as the reference. </p>

<pre><code class="r">yesno &lt;- sample(c(&quot;yes&quot;,&quot;no&quot;),size=10,replace=TRUE)
yesnofac&lt;- factor(yesno,levels=c(&quot;yes&quot;,&quot;no&quot;))
yesnofac
</code></pre>

<pre><code>##  [1] yes yes no  no  no  no  no  yes yes no 
## Levels: yes no
</code></pre>

<pre><code class="r">yesnofac1&lt;-relevel(yesnofac,ref=&quot;yes&quot;)
yesnofac1
</code></pre>

<pre><code>##  [1] yes yes no  no  no  no  no  yes yes no 
## Levels: yes no
</code></pre>

<pre><code class="r">yesnofac2&lt;-relevel(yesnofac,ref=&quot;no&quot;)
yesnofac2
</code></pre>

<pre><code>##  [1] yes yes no  no  no  no  no  yes yes no 
## Levels: no yes
</code></pre>

<pre><code class="r">as.numeric(yesnofac1)
</code></pre>

<pre><code>##  [1] 1 1 2 2 2 2 2 1 1 2
</code></pre>

<pre><code class="r">as.numeric(yesnofac2)
</code></pre>

<pre><code>##  [1] 2 2 1 1 1 1 1 2 2 1
</code></pre>

<p>##Cutting produces factor variables
Hmisc package used; g : numbers of grounps</p>

<pre><code class="r">library(Hmisc);
restData$zipGroups = cut2(restData$zipCode,g=4)
table(restData$zipGroups)
</code></pre>

<pre><code>## 
## [-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
##            338            375            300            314
</code></pre>

<pre><code class="r">str(restData)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    1327 obs. of  10 variables:
##  $ name           : Factor w/ 1277 levels &quot;#1 CHINESE KITCHEN&quot;,..: 9 3 992 1 2 4 5 6 7 8 ...
##  $ zipCode        : int  21206 21231 21224 21211 21223 21218 21205 21211 21205 21231 ...
##  $ neighborhood   : Factor w/ 173 levels &quot;Abell&quot;,&quot;Arlington&quot;,..: 53 52 18 66 104 33 98 133 98 157 ...
##  $ councilDistrict: int  2 1 1 14 9 14 13 7 13 1 ...
##  $ policeDistrict : Factor w/ 9 levels &quot;CENTRAL&quot;,&quot;EASTERN&quot;,..: 3 6 6 4 8 3 6 4 6 6 ...
##  $ Location.1     : Factor w/ 1210 levels &quot;1 BIDDLE ST\nBaltimore, MD\n&quot;,..: 835 334 554 755 492 537 505 530 507 569 ...
##  $ nearMe         : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ zipWrong       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ zipGroups      : Factor w/ 4 levels &quot;[-21226,21205)&quot;,..: 2 4 3 2 3 2 2 2 2 4 ...
##  $ zcf            : Factor w/ 32 levels &quot;-21226&quot;,&quot;21201&quot;,..: 5 27 21 10 20 17 4 10 4 27 ...
</code></pre>

<p>##Using the mutate function 
mutate add the new factor variable and create a new data.frame</p>

<pre><code class="r">library(Hmisc); 
library(plyr);
restData2 = mutate(restData,zipGroups=cut2(zipCode,g=4))
table(restData2$zipGroups)
</code></pre>

<pre><code>## 
## [-21226,21205) [ 21205,21220) [ 21220,21227) [ 21227,21287] 
##            338            375            300            314
</code></pre>

<pre><code class="r">str(restData2)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    1327 obs. of  10 variables:
##  $ name           : Factor w/ 1277 levels &quot;#1 CHINESE KITCHEN&quot;,..: 9 3 992 1 2 4 5 6 7 8 ...
##  $ zipCode        : int  21206 21231 21224 21211 21223 21218 21205 21211 21205 21231 ...
##  $ neighborhood   : Factor w/ 173 levels &quot;Abell&quot;,&quot;Arlington&quot;,..: 53 52 18 66 104 33 98 133 98 157 ...
##  $ councilDistrict: int  2 1 1 14 9 14 13 7 13 1 ...
##  $ policeDistrict : Factor w/ 9 levels &quot;CENTRAL&quot;,&quot;EASTERN&quot;,..: 3 6 6 4 8 3 6 4 6 6 ...
##  $ Location.1     : Factor w/ 1210 levels &quot;1 BIDDLE ST\nBaltimore, MD\n&quot;,..: 835 334 554 755 492 537 505 530 507 569 ...
##  $ nearMe         : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ zipWrong       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ zipGroups      : Factor w/ 4 levels &quot;[-21226,21205)&quot;,..: 2 4 3 2 3 2 2 2 2 4 ...
##  $ zcf            : Factor w/ 32 levels &quot;-21226&quot;,&quot;21201&quot;,..: 5 27 21 10 20 17 4 10 4 27 ...
</code></pre>

<p>##Common transforms</p>

<ul>
<li>abs(x) absolute value</li>
<li>sqrt(x) square root</li>
<li>ceiling(x) ceiling(3.475) is 4</li>
<li>floor(x) floor(3.475) is 3</li>
<li>round(x,digits=n) roun(3.475,digits=2) is 3.48</li>
<li>signif(x,digits=n) signif(3.475,digits=2) is 3.5</li>
<li>cos(x), sin(x) etc.</li>
<li>log(x) natural logarithm</li>
<li>log2(x), log10(x) other common logs</li>
<li>exp(x) exponentiating x</li>
</ul>

<p><a href="http://www.biostat.jhsph.edu/%7Eajaffe/lec_winterR/Lecture%202.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf</a></p>

<p><a href="http://statmethods.net/management/functions.html">http://statmethods.net/management/functions.html</a></p>

<p>##Notes and further reading</p>

<ul>
<li><p>A tutorial from the developer of plyr - <a href="http://plyr.had.co.nz/09-user/">http://plyr.had.co.nz/09-user/</a></p></li>
<li><p>Andrew Jaffe&#39;s R notes <a href="http://www.biostat.jhsph.edu/%7Eajaffe/lec_winterR/Lecture%202.pdf">http://www.biostat.jhsph.edu/~ajaffe/lec_winterR/Lecture%202.pdf</a></p></li>
</ul>

<p>#Reshaping data
##The goal is tidy data
1. Each variable forms a column
2. Each observation forms a row
3. Each table/file stores data about one kind of observation (e.g. people/hospitals).</p>

<p><a href="http://vita.had.co.nz/papers/tidy-data.pdf">http://vita.had.co.nz/papers/tidy-data.pdf</a></p>

<p><a href="http://www.plosone.org/article/info%3Adoi%2F10.1371%2Fjournal.pone.0026895">Leek, Taub, and Pineda 2011 PLoS One</a></p>

<p>##Start with reshaping</p>

<pre><code class="r">library(reshape2)
str(mtcars)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
</code></pre>

<pre><code class="r">head(mtcars)
</code></pre>

<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</code></pre>

<p>##Melting data frames
double the number of the observation due to measure.vars</p>

<pre><code class="r">mtcars$carname &lt;- rownames(mtcars)
carMelt &lt;- melt(mtcars,id=c(&quot;carname&quot;,&quot;gear&quot;,&quot;cyl&quot;),measure.vars=c(&quot;mpg&quot;,&quot;hp&quot;))
str(carMelt)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    64 obs. of  5 variables:
##  $ carname : chr  &quot;Mazda RX4&quot; &quot;Mazda RX4 Wag&quot; &quot;Datsun 710&quot; &quot;Hornet 4 Drive&quot; ...
##  $ gear    : num  4 4 4 3 3 3 3 4 4 4 ...
##  $ cyl     : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ variable: Factor w/ 2 levels &quot;mpg&quot;,&quot;hp&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ value   : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
</code></pre>

<pre><code class="r">carMelt
</code></pre>

<pre><code>##                carname gear cyl variable value
## 1            Mazda RX4    4   6      mpg  21.0
## 2        Mazda RX4 Wag    4   6      mpg  21.0
## 3           Datsun 710    4   4      mpg  22.8
## 4       Hornet 4 Drive    3   6      mpg  21.4
## 5    Hornet Sportabout    3   8      mpg  18.7
## 6              Valiant    3   6      mpg  18.1
## 7           Duster 360    3   8      mpg  14.3
## 8            Merc 240D    4   4      mpg  24.4
## 9             Merc 230    4   4      mpg  22.8
## 10            Merc 280    4   6      mpg  19.2
## 11           Merc 280C    4   6      mpg  17.8
## 12          Merc 450SE    3   8      mpg  16.4
## 13          Merc 450SL    3   8      mpg  17.3
## 14         Merc 450SLC    3   8      mpg  15.2
## 15  Cadillac Fleetwood    3   8      mpg  10.4
## 16 Lincoln Continental    3   8      mpg  10.4
## 17   Chrysler Imperial    3   8      mpg  14.7
## 18            Fiat 128    4   4      mpg  32.4
## 19         Honda Civic    4   4      mpg  30.4
## 20      Toyota Corolla    4   4      mpg  33.9
## 21       Toyota Corona    3   4      mpg  21.5
## 22    Dodge Challenger    3   8      mpg  15.5
## 23         AMC Javelin    3   8      mpg  15.2
## 24          Camaro Z28    3   8      mpg  13.3
## 25    Pontiac Firebird    3   8      mpg  19.2
## 26           Fiat X1-9    4   4      mpg  27.3
## 27       Porsche 914-2    5   4      mpg  26.0
## 28        Lotus Europa    5   4      mpg  30.4
## 29      Ford Pantera L    5   8      mpg  15.8
## 30        Ferrari Dino    5   6      mpg  19.7
## 31       Maserati Bora    5   8      mpg  15.0
## 32          Volvo 142E    4   4      mpg  21.4
## 33           Mazda RX4    4   6       hp 110.0
## 34       Mazda RX4 Wag    4   6       hp 110.0
## 35          Datsun 710    4   4       hp  93.0
## 36      Hornet 4 Drive    3   6       hp 110.0
## 37   Hornet Sportabout    3   8       hp 175.0
## 38             Valiant    3   6       hp 105.0
## 39          Duster 360    3   8       hp 245.0
## 40           Merc 240D    4   4       hp  62.0
## 41            Merc 230    4   4       hp  95.0
## 42            Merc 280    4   6       hp 123.0
## 43           Merc 280C    4   6       hp 123.0
## 44          Merc 450SE    3   8       hp 180.0
## 45          Merc 450SL    3   8       hp 180.0
## 46         Merc 450SLC    3   8       hp 180.0
## 47  Cadillac Fleetwood    3   8       hp 205.0
## 48 Lincoln Continental    3   8       hp 215.0
## 49   Chrysler Imperial    3   8       hp 230.0
## 50            Fiat 128    4   4       hp  66.0
## 51         Honda Civic    4   4       hp  52.0
## 52      Toyota Corolla    4   4       hp  65.0
## 53       Toyota Corona    3   4       hp  97.0
## 54    Dodge Challenger    3   8       hp 150.0
## 55         AMC Javelin    3   8       hp 150.0
## 56          Camaro Z28    3   8       hp 245.0
## 57    Pontiac Firebird    3   8       hp 175.0
## 58           Fiat X1-9    4   4       hp  66.0
## 59       Porsche 914-2    5   4       hp  91.0
## 60        Lotus Europa    5   4       hp 113.0
## 61      Ford Pantera L    5   8       hp 264.0
## 62        Ferrari Dino    5   6       hp 175.0
## 63       Maserati Bora    5   8       hp 335.0
## 64          Volvo 142E    4   4       hp 109.0
</code></pre>

<p>##Casting data frames</p>

<pre><code class="r">library(reshape2)
cylData &lt;- dcast(carMelt, cyl ~ variable);
</code></pre>

<pre><code>## Aggregation function missing: defaulting to length
</code></pre>

<pre><code class="r">cylData
</code></pre>

<pre><code>##   cyl mpg hp
## 1   4  11 11
## 2   6   7  7
## 3   8  14 14
</code></pre>

<pre><code class="r">cylData &lt;- dcast(carMelt, cyl ~ variable,mean)
cylData
</code></pre>

<pre><code>##   cyl      mpg        hp
## 1   4 26.66364  82.63636
## 2   6 19.74286 122.28571
## 3   8 15.10000 209.21429
</code></pre>

<p>##Averaging values</p>

<pre><code class="r">head(InsectSprays)
</code></pre>

<pre><code>##   count spray
## 1    10     A
## 2     7     A
## 3    20     A
## 4    14     A
## 5    14     A
## 6    12     A
</code></pre>

<pre><code class="r">tapply(InsectSprays$count,InsectSprays$spray,sum)
</code></pre>

<pre><code>##   A   B   C   D   E   F 
## 174 184  25  59  42 200
</code></pre>

<p>##Another way - split</p>

<pre><code class="r">spIns =  split(InsectSprays$count,InsectSprays$spray)
# or spIns &lt;- with(InsectSprays, split(count, spray))
spIns
</code></pre>

<pre><code>## $A
##  [1] 10  7 20 14 14 12 10 23 17 20 14 13
## 
## $B
##  [1] 11 17 21 11 16 14 17 17 19 21  7 13
## 
## $C
##  [1] 0 1 7 2 3 1 2 1 3 0 1 4
## 
## $D
##  [1]  3  5 12  6  4  3  5  5  5  5  2  4
## 
## $E
##  [1] 3 5 3 5 3 6 1 1 3 2 6 4
## 
## $F
##  [1] 11  9 15 22 15 16 13 10 26 26 24 13
</code></pre>

<p>##Another way - apply</p>

<pre><code class="r">sprCount = lapply(spIns,sum)
sprCount
</code></pre>

<pre><code>## $A
## [1] 174
## 
## $B
## [1] 184
## 
## $C
## [1] 25
## 
## $D
## [1] 59
## 
## $E
## [1] 42
## 
## $F
## [1] 200
</code></pre>

<p>##Another way - combine</p>

<pre><code class="r">unlist(sprCount)
</code></pre>

<pre><code>##   A   B   C   D   E   F 
## 174 184  25  59  42 200
</code></pre>

<pre><code class="r">sapply(spIns,sum)
</code></pre>

<pre><code>##   A   B   C   D   E   F 
## 174 184  25  59  42 200
</code></pre>

<p>##Another way - plyr package
in  plyr package, it is &ldquo;summarise&rdquo; rather than &ldquo;summarize&rdquo;</p>

<pre><code class="r">ddply(InsectSprays,.(spray),summarise,sum=sum(count))
</code></pre>

<pre><code>##   spray sum
## 1     A 174
## 2     B 184
## 3     C  25
## 4     D  59
## 5     E  42
## 6     F 200
</code></pre>

<p>##Creating a new variable</p>

<pre><code class="r">spraySums &lt;- ddply(InsectSprays,.(spray),summarise,sum=ave(count,FUN=sum))
dim(spraySums)
</code></pre>

<pre><code>## [1] 72  2
</code></pre>

<pre><code class="r">spraySums
</code></pre>

<pre><code>##    spray sum
## 1      A 174
## 2      A 174
## 3      A 174
## 4      A 174
## 5      A 174
## 6      A 174
## 7      A 174
## 8      A 174
## 9      A 174
## 10     A 174
## 11     A 174
## 12     A 174
## 13     B 184
## 14     B 184
## 15     B 184
## 16     B 184
## 17     B 184
## 18     B 184
## 19     B 184
## 20     B 184
## 21     B 184
## 22     B 184
## 23     B 184
## 24     B 184
## 25     C  25
## 26     C  25
## 27     C  25
## 28     C  25
## 29     C  25
## 30     C  25
## 31     C  25
## 32     C  25
## 33     C  25
## 34     C  25
## 35     C  25
## 36     C  25
## 37     D  59
## 38     D  59
## 39     D  59
## 40     D  59
## 41     D  59
## 42     D  59
## 43     D  59
## 44     D  59
## 45     D  59
## 46     D  59
## 47     D  59
## 48     D  59
## 49     E  42
## 50     E  42
## 51     E  42
## 52     E  42
## 53     E  42
## 54     E  42
## 55     E  42
## 56     E  42
## 57     E  42
## 58     E  42
## 59     E  42
## 60     E  42
## 61     F 200
## 62     F 200
## 63     F 200
## 64     F 200
## 65     F 200
## 66     F 200
## 67     F 200
## 68     F 200
## 69     F 200
## 70     F 200
## 71     F 200
## 72     F 200
</code></pre>

<p>split the count column by the spray column.</p>

<pre><code class="r">count_by_spray &lt;- with(InsectSprays, split(count, spray))
</code></pre>

<p>apply the statistic to each element of the list. Lets use the mean here.</p>

<pre><code class="r">count_by_spray &lt;- with(InsectSprays, split(count, spray))
mean_by_spray &lt;- lapply(count_by_spray, mean)
unlist(mean_by_spray)
</code></pre>

<pre><code>##         A         B         C         D         E         F 
## 14.500000 15.333333  2.083333  4.916667  3.500000 16.666667
</code></pre>

<p>##lit-apply-combine problems(S-A-C)
We can do even better than that however. tapply, aggregate and by all provide 
a one-function solution to these S-A-C problems.</p>

<pre><code class="r">with(InsectSprays, tapply(count, spray, mean))
</code></pre>

<pre><code>##         A         B         C         D         E         F 
## 14.500000 15.333333  2.083333  4.916667  3.500000 16.666667
</code></pre>

<pre><code class="r">with(InsectSprays, by(count, spray, mean))
</code></pre>

<pre><code>## spray: A
## [1] 14.5
## -------------------------------------------------------- 
## spray: B
## [1] 15.33333
## -------------------------------------------------------- 
## spray: C
## [1] 2.083333
## -------------------------------------------------------- 
## spray: D
## [1] 4.916667
## -------------------------------------------------------- 
## spray: E
## [1] 3.5
## -------------------------------------------------------- 
## spray: F
## [1] 16.66667
</code></pre>

<pre><code class="r">aggregate(count ~ spray, InsectSprays, mean)
</code></pre>

<pre><code>##   spray     count
## 1     A 14.500000
## 2     B 15.333333
## 3     C  2.083333
## 4     D  4.916667
## 5     E  3.500000
## 6     F 16.666667
</code></pre>

<pre><code class="r">dlply(InsectSprays, .(spray), summarise, mean.count = mean(count))
</code></pre>

<pre><code>## $A
##   mean.count
## 1       14.5
## 
## $B
##   mean.count
## 1   15.33333
## 
## $C
##   mean.count
## 1   2.083333
## 
## $D
##   mean.count
## 1   4.916667
## 
## $E
##   mean.count
## 1        3.5
## 
## $F
##   mean.count
## 1   16.66667
## 
## attr(,&quot;split_type&quot;)
## [1] &quot;data.frame&quot;
## attr(,&quot;split_labels&quot;)
##   spray
## 1     A
## 2     B
## 3     C
## 4     D
## 5     E
## 6     F
</code></pre>

<p>One tiny variation on the problem is when you want the output statistic vector to have the same length as the original input vectors. For this, there is the ave function (which provides mean as the default function).</p>

<pre><code class="r">with(InsectSprays, ave(count, spray))
</code></pre>

<pre><code>##  [1] 14.500000 14.500000 14.500000 14.500000 14.500000 14.500000 14.500000
##  [8] 14.500000 14.500000 14.500000 14.500000 14.500000 15.333333 15.333333
## [15] 15.333333 15.333333 15.333333 15.333333 15.333333 15.333333 15.333333
## [22] 15.333333 15.333333 15.333333  2.083333  2.083333  2.083333  2.083333
## [29]  2.083333  2.083333  2.083333  2.083333  2.083333  2.083333  2.083333
## [36]  2.083333  4.916667  4.916667  4.916667  4.916667  4.916667  4.916667
## [43]  4.916667  4.916667  4.916667  4.916667  4.916667  4.916667  3.500000
## [50]  3.500000  3.500000  3.500000  3.500000  3.500000  3.500000  3.500000
## [57]  3.500000  3.500000  3.500000  3.500000 16.666667 16.666667 16.666667
## [64] 16.666667 16.666667 16.666667 16.666667 16.666667 16.666667 16.666667
## [71] 16.666667 16.666667
</code></pre>

<p>##More information</p>

<ul>
<li>A tutorial from the developer of plyr - <a href="http://plyr.had.co.nz/09-user/">http://plyr.had.co.nz/09-user/</a></li>
<li>A nice reshape tutorial <a href="http://www.slideshare.net/jeffreybreen/reshaping-data-in-r">http://www.slideshare.net/jeffreybreen/reshaping-data-in-r</a></li>
<li>A good plyr primer - <a href="http://www.r-bloggers.com/a-quick-primer-on-split-apply-combine-problems/">http://www.r-bloggers.com/a-quick-primer-on-split-apply-combine-problems/</a></li>
<li>See also the functions

<ul>
<li>acast - for casting as multi-dimensional arrays</li>
<li>arrange - for faster reordering without using order() commands</li>
<li>mutate - adding new variables</li>
</ul></li>
</ul>

<p>#Merging data
##Peer review experiment data
<a href="%22http://www.plosone.org/article/info:doi/10.1371/journal.pone.0026895%22">data source</a></p>

<pre><code class="r">#if(!file.exists(&quot;./data&quot;)){dir.create(&quot;./data&quot;)}
#fileUrl1 = &quot;https://dl.dropboxusercontent.com/u/7710864/data/reviews-apr29.csv&quot;
#fileUrl2 = &quot;https://dl.dropboxusercontent.com/u/7710864/data/solutions-apr29.csv&quot;
##download.file(fileUrl1,destfile=&quot;./data/reviews.csv&quot;,method=&quot;curl&quot;)
#download.file(fileUrl2,destfile=&quot;./data/solutions.csv&quot;,method=&quot;curl&quot;)
reviews = read.csv(&quot;./data/reviews.csv&quot;);
solutions &lt;- read.csv(&quot;./data/solutions.csv&quot;);
</code></pre>

<pre><code class="r">#str(reviews)
head(reviews)
</code></pre>

<pre><code>##   id solution_id reviewer_id      start       stop time_left accept
## 1  1           3          27 1304095698 1304095758      1754      1
## 2  2           4          22 1304095188 1304095206      2306      1
## 3  3           5          28 1304095276 1304095320      2192      1
## 4  4           1          26 1304095267 1304095423      2089      1
## 5  5          10          29 1304095456 1304095469      2043      1
## 6  6           2          29 1304095471 1304095513      1999      1
</code></pre>

<pre><code class="r">#str(solutions)
head(solutions)
</code></pre>

<pre><code>##   id problem_id subject_id      start       stop time_left answer
## 1  1        156         29 1304095119 1304095169      2343      B
## 2  2        269         25 1304095119 1304095183      2329      C
## 3  3         34         22 1304095127 1304095146      2366      C
## 4  4         19         23 1304095127 1304095150      2362      D
## 5  5        605         26 1304095127 1304095167      2345      A
## 6  6        384         27 1304095131 1304095270      2242      C
</code></pre>

<p>##Merging data - merge()</p>

<ul>
<li>Merges data frames</li>
<li>Important parameters: x,y,by,by.x,by.y,all</li>
</ul>

<pre><code class="r">names(reviews)
</code></pre>

<pre><code>## [1] &quot;id&quot;          &quot;solution_id&quot; &quot;reviewer_id&quot; &quot;start&quot;       &quot;stop&quot;       
## [6] &quot;time_left&quot;   &quot;accept&quot;
</code></pre>

<pre><code class="r">names(solutions)
</code></pre>

<pre><code>## [1] &quot;id&quot;         &quot;problem_id&quot; &quot;subject_id&quot; &quot;start&quot;      &quot;stop&quot;      
## [6] &quot;time_left&quot;  &quot;answer&quot;
</code></pre>

<pre><code class="r">mergedData = merge(reviews,solutions,by.x=&quot;solution_id&quot;,by.y=&quot;id&quot;,all=TRUE)
head(mergedData)
</code></pre>

<pre><code>##   solution_id id reviewer_id    start.x     stop.x time_left.x accept
## 1           1  4          26 1304095267 1304095423        2089      1
## 2           2  6          29 1304095471 1304095513        1999      1
## 3           3  1          27 1304095698 1304095758        1754      1
## 4           4  2          22 1304095188 1304095206        2306      1
## 5           5  3          28 1304095276 1304095320        2192      1
## 6           6 16          22 1304095303 1304095471        2041      1
##   problem_id subject_id    start.y     stop.y time_left.y answer
## 1        156         29 1304095119 1304095169        2343      B
## 2        269         25 1304095119 1304095183        2329      C
## 3         34         22 1304095127 1304095146        2366      C
## 4         19         23 1304095127 1304095150        2362      D
## 5        605         26 1304095127 1304095167        2345      A
## 6        384         27 1304095131 1304095270        2242      C
</code></pre>

<p>##Default - merge all common column names</p>

<pre><code class="r">intersect(names(solutions),names(reviews))
</code></pre>

<pre><code>## [1] &quot;id&quot;        &quot;start&quot;     &quot;stop&quot;      &quot;time_left&quot;
</code></pre>

<pre><code class="r">mergedData2 = merge(reviews,solutions,all=TRUE)
head(mergedData2)
</code></pre>

<pre><code>##   id      start       stop time_left solution_id reviewer_id accept
## 1  1 1304095119 1304095169      2343          NA          NA     NA
## 2  1 1304095698 1304095758      1754           3          27      1
## 3  2 1304095119 1304095183      2329          NA          NA     NA
## 4  2 1304095188 1304095206      2306           4          22      1
## 5  3 1304095127 1304095146      2366          NA          NA     NA
## 6  3 1304095276 1304095320      2192           5          28      1
##   problem_id subject_id answer
## 1        156         29      B
## 2         NA         NA   &lt;NA&gt;
## 3        269         25      C
## 4         NA         NA   &lt;NA&gt;
## 5         34         22      C
## 6         NA         NA   &lt;NA&gt;
</code></pre>

<p>##Using join in the plyr package
Faster, but less full featured - defaults to left join, see help file for more</p>

<pre><code class="r">df1 = data.frame(id=sample(1:10),x=rnorm(10))
df2 = data.frame(id=sample(1:10),y=rnorm(10))
df1 
</code></pre>

<pre><code>##    id          x
## 1   9  0.2365916
## 2   6  1.7473499
## 3   8 -1.0178761
## 4   7  1.0070288
## 5   2 -1.8963536
## 6   4  0.9995930
## 7   1  1.9963144
## 8   3 -0.7388428
## 9  10 -0.3393521
## 10  5  2.6998482
</code></pre>

<pre><code class="r">df2
</code></pre>

<pre><code>##    id           y
## 1   5 -0.75669479
## 2   8 -1.42659738
## 3   9 -0.30153092
## 4  10 -0.77924959
## 5   2 -1.06584640
## 6   4  0.07436382
## 7   3  2.04580330
## 8   7  0.64047066
## 9   1  1.16579466
## 10  6  0.92514533
</code></pre>

<pre><code class="r">arrange(join(df1,df2),id)
</code></pre>

<pre><code>## Joining by: id
</code></pre>

<pre><code>##    id          x           y
## 1   1  1.9963144  1.16579466
## 2   2 -1.8963536 -1.06584640
## 3   3 -0.7388428  2.04580330
## 4   4  0.9995930  0.07436382
## 5   5  2.6998482 -0.75669479
## 6   6  1.7473499  0.92514533
## 7   7  1.0070288  0.64047066
## 8   8 -1.0178761 -1.42659738
## 9   9  0.2365916 -0.30153092
## 10 10 -0.3393521 -0.77924959
</code></pre>

<pre><code class="r">df1 = data.frame(x=rnorm(10),id=sample(1:10))
df2 = data.frame(id=sample(1:10),y=rnorm(10))
arrange(join(df1,df2),id)
</code></pre>

<pre><code>## Joining by: id
</code></pre>

<pre><code>##             x id          y
## 1   2.8547047  1 -0.6123399
## 2   1.5945879  2 -0.5200716
## 3   0.9344478  3  0.9849817
## 4   0.8899654  4  1.0923723
## 5   1.5570227  5 -0.9235868
## 6   0.9846910  6 -0.5563688
## 7  -0.7502527  7 -1.1863767
## 8  -2.9943179  8  1.1704015
## 9   1.6631246  9  1.0485269
## 10  0.8813762 10 -0.1691039
</code></pre>

<pre><code class="r">df1 = data.frame(x=rnorm(10),id1=sample(1:10),id2=sample(1:10))
df2 = data.frame(y=rnorm(10),id1=sample(1:10),id2=sample(1:10))
df1
</code></pre>

<pre><code>##              x id1 id2
## 1   1.04991074   9   4
## 2   1.34800556   3   7
## 3  -0.48145232   8   3
## 4  -0.07217816   4   6
## 5   1.06494765   2   8
## 6   1.20169255   6   9
## 7  -0.59426347  10   1
## 8   0.64950264   5   2
## 9  -0.59950734   7  10
## 10  0.07266156   1   5
</code></pre>

<pre><code class="r">df2
</code></pre>

<pre><code>##                y id1 id2
## 1   1.0707399659   6   1
## 2  -0.6891144569   4   6
## 3   0.5050501980  10   7
## 4   0.6564025537   8   2
## 5   1.7752005169   1   8
## 6  -1.0688107513   7   4
## 7   0.5965955546   5  10
## 8  -0.0002946376   3   5
## 9   1.1724617866   2   3
## 10  0.3380950122   9   9
</code></pre>

<pre><code class="r">arrange(join(df1,df2),id1)
</code></pre>

<pre><code>## Joining by: id1, id2
</code></pre>

<pre><code>##              x id1 id2          y
## 1   0.07266156   1   5         NA
## 2   1.06494765   2   8         NA
## 3   1.34800556   3   7         NA
## 4  -0.07217816   4   6 -0.6891145
## 5   0.64950264   5   2         NA
## 6   1.20169255   6   9         NA
## 7  -0.59950734   7  10         NA
## 8  -0.48145232   8   3         NA
## 9   1.04991074   9   4         NA
## 10 -0.59426347  10   1         NA
</code></pre>

<p>##If you have multiple data frames</p>

<pre><code class="r">df1 = data.frame(id=sample(1:10),x=rnorm(10))
df2 = data.frame(id=sample(1:10),y=rnorm(10))
df3 = data.frame(id=sample(1:10),z=rnorm(10))
dfList = list(df1,df2,df3)
join_all(dfList)
</code></pre>

<pre><code>## Joining by: id
## Joining by: id
</code></pre>

<pre><code>##    id           x          y           z
## 1   4  0.68063318  0.1099471  0.83794605
## 2   6  1.12868346  0.0337646 -0.28656824
## 3   8  0.02381784  0.2954425 -0.36325001
## 4   1  0.03778781  0.3899207  0.26385292
## 5  10 -0.53215032  1.3141084 -0.10923453
## 6   5 -0.87853245  0.3780575  0.84236394
## 7   7  0.69541607 -0.9916345 -0.09021139
## 8   9  0.01567956  1.2852661 -0.24384926
## 9   2 -0.19296261  0.6815632  0.47859271
## 10  3 -0.04788990  0.2042565 -2.11600535
</code></pre>

<p>##More on merging data</p>

<ul>
<li>The quick R data merging page - <a href="http://www.statmethods.net/management/merging.html">http://www.statmethods.net/management/merging.html</a></li>
<li>plyr information - <a href="http://plyr.had.co.nz/">http://plyr.had.co.nz/</a></li>
<li>Types of joins - <a href="http://en.wikipedia.org/wiki/Join_(SQL)">http://en.wikipedia.org/wiki/Join_(SQL)</a></li>
</ul>

</body>

</html>
